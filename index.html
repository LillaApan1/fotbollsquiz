<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Fotbollsquiz</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin:0;
  font-family: Arial;
  background: linear-gradient(120deg,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
}
.box {
  max-width:500px;
  margin:50px auto;
  background:rgba(0,0,0,0.6);
  padding:25px;
  border-radius:15px;
}
button {
  width:100%;
  padding:12px;
  margin:8px 0;
  font-size:16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
button:hover { opacity:0.9; }
input {
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:8px;
  border:none;
}
</style>
</head>

<body>

<div id="login" class="box">
  <h2>Skriv ditt namn</h2>
  <input id="username" placeholder="Ditt namn">
  <button id="startBtn">Forts√§tt</button>
</div>

<div id="menu" class="box" style="display:none;">
  <h2>V√§lj quiz</h2>
  <button onclick="startQuiz('pl')">Premier League</button>
  <button onclick="startQuiz('vm')">VM</button>
  <button onclick="startQuiz('as')">Allsvenskan</button>
</div>

<div id="quiz" class="box" style="display:none;">
  <h3 id="progress"></h3>
  <h2 id="question"></h2>
  <div id="answers"></div>
</div>

<div id="result" class="box" style="display:none;">
  <h2 id="scoreText"></h2>
  <h3>üèÜ Topp 3 i v√§rlden</h3>
  <ol id="top3"></ol>
  <p id="myRank"></p>
</div>

<script>
/* ================= FIREBASE ================= */

const firebaseConfig = {
  apiKey: "AIzaSyBApn2aTw1V7smbRbtwyvdDpD1iBJvzcY0",
  authDomain: "global-football-quiz.firebaseapp.com",
  projectId: "global-football-quiz",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= QUIZDATA ================= */

const quizzes = {
  pl: [
    {q:"Vilken spelare gjorde flest m√•l PL 2007/08?", a:["Ronaldo","Drogba","Henry"], c:0},
    {q:"Vilket lag vann PL s√§songen 2015/16?", a:["Chelsea","Leicester","Arsenal"], c:1}
  ],
  vm: [
    {q:"VM 1998 vanns av?", a:["Brasilien","Frankrike","Italien"], c:1},
    {q:"Flest VM-m√•l totalt?", a:["Ronaldo","Klose","Pel√©"], c:1}
  ],
  as: [
    {q:"Vilket lag har flest SM-guld?", a:["Malm√∂ FF","AIK","IFK G√∂teborg"], c:0},
    {q:"Allsvenskan startade vilket √•r?", a:["1910","1924","1935"], c:1}
  ]
};

/* ================= VARIABLER ================= */

let user="";
let quiz=[];
let current=0;
let score=0;
let timeLeft=10;
let timer=null;

/* ================= LOGIN ================= */

document.getElementById("startBtn").onclick = () => {
  const name = document.getElementById("username").value.trim();
  if(!name){ alert("Skriv ditt namn"); return; }
  user=name;
  document.getElementById("login").style.display="none";
  document.getElementById("menu").style.display="block";
};

/* ================= QUIZ ================= */

function startQuiz(type){
  quiz=[...quizzes[type]].sort(()=>Math.random()-0.5);
  current=0;
  score=0;
  document.getElementById("menu").style.display="none";
  document.getElementById("quiz").style.display="block";
  showQuestion();
}

function showQuestion(){
  clearInterval(timer);
  timeLeft=10;

  const q=quiz[current];
  document.getElementById("question").innerText=q.q;
  document.getElementById("progress").innerText=
    `Fr√•ga ${current+1} av ${quiz.length} ‚è±Ô∏è ${timeLeft}s`;

  const answers=document.getElementById("answers");
  answers.innerHTML="";

  q.a.forEach((text,i)=>{
    const btn=document.createElement("button");
    btn.innerText=text;
    btn.onclick=()=>answer(i);
    answers.appendChild(btn);
  });

  timer=setInterval(()=>{
    timeLeft--;
    document.getElementById("progress").innerText=
      `Fr√•ga ${current+1} av ${quiz.length} ‚è±Ô∏è ${timeLeft}s`;
    if(timeLeft<=0){
      clearInterval(timer);
      next();
    }
  },1000);
}

function answer(i){
  if(i===quiz[current].c) score++;
  next();
}

function next(){
  current++;
  current<quiz.length ? showQuestion() : finish();
}

/* ================= RESULT ================= */

async function finish(){
  document.getElementById("quiz").style.display="none";
  document.getElementById("result").style.display="block";
  document.getElementById("scoreText").innerText=
    `${user}, du fick ${score} po√§ng`;

  const ref=db.collection("players").doc(user);
  const snap=await ref.get();
  let total=score;
  if(snap.exists) total+=snap.data().points;
  await ref.set({points:total});

  const list=await db.collection("players")
    .orderBy("points","desc").get();

  let rank=0;
  const top3=document.getElementById("top3");
  top3.innerHTML="";

  list.forEach(d=>{
    rank++;
    if(rank<=3){
      const li=document.createElement("li");
      li.innerText=`${d.id} ‚Äì ${d.data().points} po√§ng`;
      top3.appendChild(li);
    }
    if(d.id===user){
      document.getElementById("myRank").innerText=
        `Din plats i v√§rlden: #${rank} (${d.data().points} po√§ng)`;
    }
  });
}
</script>

</body>
</html>
